<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" name="viewport"><meta name="description" content="bkp | hexo+yuque"><meta name="hexo-theme-A4" content="v1.7.0"><link rel="alternate icon" type="image/webp" href="/img/favicon.webp"><title>4AF | Dont waste life</title><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/markdown.css"><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/ui.css"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.2"></head><style>:root{--waline-theme-color:#000000;--waline-color:#000000;--waline-border-color:#000000;--waline-white:#000000;--waline-bgcolor-light:#ffffff}body{color:#000;background:#e4e4e4}.post-md code{background:#000;color:#fff}.year-font-color{color:#000!important}.wl-card span.wl-nick{color:#000}.wl-card .wl-badge{border:1px solid #000;color:#000}.wl-btn{border:1px solid #000;color:#000}.wl-btn.primary{color:#fff}.wl-header label{color:#000}a{color:#4f7dde}.post-md a{color:#4f7dde}.nav li a{color:#4f7dde}.archive-main a:link{color:#4f7dde}.archive-main a:visited{color:#2f4f4f}.archive li span{color:#000}.post-main-title{color:#000}.post-md h1,.post-md h2,.post-md h3,.post-md h4,.post-md h5,.post-md h6{color:#000}[data-waline] p{color:#000}[data-waline] a{color:#000}.wl-sort li.active{color:#000}.wl-card .wl-meta>span{background:#fff}.paper{background:#e4e4e4}.index-main{background:#fff}.paper-main{background:#fff}.wl-panel{background:#fff}.archive li:nth-child(odd){background:#fff}.archive li:nth-child(even){background:#fff}.post-md>table tr:nth-child(odd) td{background:#fff}.post-md>table tr:nth-child(even) td{background:#fff}</style><body><div class="paper"><div class="shadow-drop-2-bottom paper-main"><div class="header"><div class="header-container"><img style="width:56px;height:auto" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"><div class="header-content"><a class="logo" href="/">4AF</a> <span class="description"></span></div></div><ul class="nav"><li><a href="/index/">Home</a></li><li><a href="/list/">Archive</a></li></ul></div><div class="post-main"><div class="post-main-title">bkp | hexo+yuque</div><div class="post-md"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%B0%86yuque%E5%8F%98%E4%B8%BAhexo%E5%A4%87%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="post-toc-text">实现将yuque变为hexo备用数据库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x0-prequisite"><span class="post-toc-text">0x0 prequisite</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Operations"><span class="post-toc-text">0x01 Operations</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#basic"><span class="post-toc-text">basic</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#github-actions%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0"><span class="post-toc-text">github actions自动更新</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AEserverless-%E4%BA%91%E5%87%BD%E6%95%B0"><span class="post-toc-text">配置serverless 云函数</span></a></li></ol></li></ol></li></ol><p><img src="c0952b7cd3d41b48cf56d33fbebfef82.jpeg" alt="true"></p><blockquote><p>🌟🌟🌟🌟<br><em>日常除了用原生.md写笔记，还尝试过yuque,体验4星，升级了它的超级会员，所以干脆做个临时备份数据库。开干。</em></p></blockquote><p><a target="_blank" rel="noopener" href="https://www.yuque.com/leader755/blog/egko8o">点我查看官方文档</a></p><h1 id="实现将yuque变为hexo备用数据库"><a href="#实现将yuque变为hexo备用数据库" class="headerlink" title="实现将yuque变为hexo备用数据库"></a><font color="blue" size="5">实现将yuque变为hexo备用数据库</font></h1><h2 id="0x0-prequisite"><a href="#0x0-prequisite" class="headerlink" title="0x0 prequisite"></a><font color="blue" size="5">0x0 prequisite</font></h2><p>以下是我们将用到的工具：</p><p>1.yuque-hexo插件<br>2.已注册好的一个Github账户<br>3.已注册好的一个腾讯云账号<br>4.一个语雀超级会员账号<br>4.默认已有搭建好的hexo博客</p><p>大致思路：</p><p>借助yuque webhook触发腾讯云serverless云函数，云函数再触发github actions去自动执行hexo的命令从而实现同步。</p><h2 id="0x01-Operations"><a href="#0x01-Operations" class="headerlink" title="0x01 Operations"></a><font color="blue" size="5">0x01 Operations</font></h2><h3 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h3><p>首先需要安装插件：<a target="_blank" rel="noopener" href="https://github.com/x-cold/yuque-hexo">https://github.com/x-cold/yuque-hexo</a></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">-g</span> yuque-hexo</code></pre><p>编辑hexo根目录下的package.json，添加如下内容</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token property">"yuqueConfig"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token property">"postPath"</span><span class="token operator">:</span> <span class="token string">"source/_posts"</span><span class="token punctuation">,</span>
  <span class="token property">"cachePath"</span><span class="token operator">:</span> <span class="token string">"yuque.json"</span><span class="token punctuation">,</span>
  <span class="token property">"mdNameFormat"</span><span class="token operator">:</span> <span class="token string">"slug"</span><span class="token punctuation">,</span>
  <span class="token property">"adapter"</span><span class="token operator">:</span> <span class="token string">"hexo"</span><span class="token punctuation">,</span>
  <span class="token property">"concurrency"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"https://www.yuque.com/api/v2"</span><span class="token punctuation">,</span>
  <span class="token property">"login"</span><span class="token operator">:</span> <span class="token string">"u32979443"</span><span class="token punctuation">,</span>
  <span class="token property">"repo"</span><span class="token operator">:</span> <span class="token string">"ad1er"</span><span class="token punctuation">,</span>
  <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"语雀token"</span><span class="token punctuation">,</span>
  <span class="token property">"onlyPublished"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"onlyPublic"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token property">"yuque-hexo"</span><span class="token operator">:</span> <span class="token string">"^1.9.5"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token property">"hexo"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"5.4.2"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre><p>必要内容参数说明：</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"这个是固定的，不用更改"</span><span class="token punctuation">,</span>
<span class="token property">"login"</span><span class="token operator">:</span> <span class="token string">"语雀账户设置-->账户管理-->个人路径：https://www.yuque.com/后面的这串字符"</span><span class="token punctuation">,</span>
<span class="token property">"repo"</span><span class="token operator">:</span> <span class="token string">"知识库路径名称"</span><span class="token punctuation">,</span>
<span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"语雀token"</span><span class="token punctuation">,</span></code></pre><p><img src="b05738426f28cda92d6180fe0327af2c.png"></p><p>修改”scripts”：</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"hexo generate"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"clean"</span><span class="token operator">:</span> <span class="token string">"hexo clean"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"deploy"</span><span class="token operator">:</span> <span class="token string">"hexo deploy"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"server"</span><span class="token operator">:</span> <span class="token string">"hexo server"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"sync"</span><span class="token operator">:</span> <span class="token string">"yuque-hexo sync"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"clean:yuque"</span><span class="token operator">:</span> <span class="token string">"yuque-hexo clean"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre><p>yuque-hexo sync 命令会将yuque的文章下载到source/_post,然后hexo g &amp;&amp; hexo s/d 就可访问本地127.0.0.1:4000查看了.</p><p><font color="pink" size="5">else</font></p><ul><li>图片无法正常加载<br>编辑：主题/layout/post.ejs,添加这句话。<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>referrer<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-referrer<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre></li></ul><h3 id="github-actions自动更新"><a href="#github-actions自动更新" class="headerlink" title="github actions自动更新"></a><font color="blue" size="5">github actions自动更新</font></h3><p>创建一个新的私有仓库，任意命名。<br>站点根目录执行如下：</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> init
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"first commit"</span>
<span class="token function">git</span> remote <span class="token function">add</span> origin https://github.com/name/博客名.git
<span class="token function">git</span> push <span class="token parameter variable">-u</span> origin master
</code></pre><p>设置一个github token,以后只用勾选repo这个选项即可</p><p>来到新仓库–&gt;secret–&gt;分别添加GH_REF/GE_TOKEN，其中GH_REF是你博客的仓库地址，不加http://头。</p><p>新仓库–&gt;actions–&gt;set up a workflow yourself–&gt;编辑内容</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Blog CI/CD

<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">,</span> repository_dispatch<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">blog-cicd</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Hexo blog build &amp; deploy
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout codes
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup node
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">"12.x"</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache node modules
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v1
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> ~/.npm
          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> runner.os <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          npm install hexo-cli -g
          npm install yuque-hexo -g
          npm install
          yuque-hexo sync</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate files
        <span class="token key atrule">run</span><span class="token punctuation">:</span> hexo generate

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy blog
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          git clone "https://$&#123;&#123; secrets.GH_REF &#125;&#125;" deploy_git
          mv ./deploy_git/.git ./public/
          cd ./public
          git config user.name "username here"
          git config user.email "emailhere"
          git add .
          git commit -m "GitHub Actions Auto Builder at $(date +'%Y-%m-%d %H:%M:%S')"
          git push --force --quiet "https://$&#123;&#123; secrets.GH_TOKEN &#125;&#125;@$&#123;&#123; secrets.GH_REF &#125;&#125;" master:master</span>
</code></pre><p>对照修改一下个人信息，每当你push/repo_dispatch的时候都会自动更新。</p><h3 id="配置serverless-云函数"><a href="#配置serverless-云函数" class="headerlink" title="配置serverless 云函数"></a><font color="blue" size="5">配置serverless 云函数</font></h3><p>这个云函数也要收费，但是免费额度一般够用。<br>注册腾讯云账号：<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/scf/">https://console.cloud.tencent.com/scf/</a></p><p>新建函数服务—&gt;空白函数，内容如下</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf8 -*-</span>
<span class="token keyword">import</span> requests

<span class="token keyword">def</span> <span class="token function">main_handler</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"https://api.github.com/repos/username/repo name/dispatches"</span><span class="token punctuation">,</span>
    json <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"event_type"</span><span class="token punctuation">:</span> <span class="token string">"run-it"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span><span class="token string">'curl/7.52.1'</span><span class="token punctuation">,</span>
              <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
              <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/vnd.github.everest-preview+json'</span><span class="token punctuation">,</span>
              <span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'token 你的GH_TOKEN'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">204</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"This's OK!"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> r<span class="token punctuation">.</span>status_code</code></pre><p>参数说明：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'token (你的GH_TOKEN)'</span>
<span class="token comment">#你只需要修改()里的内容</span></code></pre><p>测试，直到返回”This is OK!”—&gt;同时你的github actions会自动去执行之前在main.yml设定的，检查博客情况就可以了。</p><p>回到腾讯云—&gt;函数服务–&gt;触发管理—&gt;创建触发器，一般保持默认设置—&gt;会生成一个访问路径，记下来！—&gt;回到yuque—&gt;知识库的设置—&gt;添加web hook url:填写刚刚生成的路径，🆗！</p><pre class="language-markdown" data-language="markdown"><code class="language-markdown"><span class="token italic"><span class="token punctuation">_</span><span class="token content">N0nsence:uh,语雀最近发生了几次P0事故，相对安全的还是本地存储.</span><span class="token punctuation">_</span></span></code></pre></div><div class="post-meta"><i><span>2023-05-28</span></i></div></div><div class="footer"><span>© 1949-2099</span></div><div class="footer-last"><span>🌊看过大海的人不会忘记海的广阔🌊</span> <span class="footer-last-span-right"><i>本站由<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>驱动｜使用<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>主题</i></span></div><link rel="stylesheet" href="/css/a11y-dark.min.css"><script src="/js/highlight.min.js"></script><script src="/js/highlightjs-line-numbers.js"></script><script>hljs.initHighlightingOnLoad(),hljs.initLineNumbersOnLoad()</script></div></div></body></html>